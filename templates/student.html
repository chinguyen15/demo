<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Thông tin SVTT</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Yeseva+One&display=swap');

      h3{
        font-family: 'Yeseva One', cursive;
        text-align: center;
        color: rgba(0, 0, 0, 0.85);
      }
    </style>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- sweetalert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- DATATABLE -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.css" />
    <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.js"></script>
  </head>
  <body>
    <nav class="navbar bg-dark border-bottom border-bottom-dark" data-bs-theme="dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">TTCNTT-VNPT VLG</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
    </nav>
    <div class="container mt-4">
      <h3>Thông tin sinh viên</h3>
      <div class="col-sm-8 mx-auto row mb-3">
        <div class="card">
          <div class="card-body">
            {% for i in student_info %}
            <form id="student_information">
              <div class="mb-3 row">
                <label for="student_id" class="col-sm-2 col-form-label">MSSV</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="student_id" value="{{ i.student_id }}" disabled>
                </div>
              </div>
              <div class="mb-3 row">
                <label for="fullname" class="col-sm-2 col-form-label">Họ tên</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="fullname" value="{{ i.fullname }}" disabled>
                </div>
              </div>
              <div class="mb-3 row">
                <label for="phone_number" class="col-sm-2 col-form-label">SĐT</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="phone_number" value="{{ i.phone_number }}" disabled>
                </div>
              </div>
              <div class="mb-3 row">
                <label for="email" class="col-sm-2 col-form-label">Email</label>
                <div class="col-sm-10">
                  <input type="email" class="form-control" id="email" value="{{ i.email }}" disabled>
                </div>
              </div>
              <div class="mb-3 row">
                <label for="address" class="col-sm-2 col-form-label">Địa chỉ</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="address" value="{{ i.address }}" disabled>
                </div>
              </div>
              <div class="mb-3 row">
                <label for="major" class="col-sm-2 col-form-label">Ngành</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="major" value="{{ i.major }}" disabled>
                </div>
              </div>
              <div class="mb-3 row">
                <label for="course" class="col-sm-2 col-form-label">Khóa</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="course" value="{{ i.course }}" disabled>
                </div>
              </div>
              <div class="mb-3 row">
                <label for="college" class="col-sm-2 col-form-label">Trường</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="college" value="{{ i.college }}" disabled>
                </div>
              </div>
              <div class="mb-3 row">
                <label for="intern_time" class="col-sm-2 col-form-label">Thực tập</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="intern_time" value="{{ i.internship_start }} - {{ i.internship_end }}" disabled>
                </div>
              </div>
              <div class="mb-3 row">
                <label for="project" class="col-sm-2 col-form-label">Đề tài</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="project" value="{{ i.project }}" disabled>
                </div>
                <div class="col-sm-1">
                  <a href="/chitietnhom?id={{ i.interngroup_id }}"><i class="fa-solid fa-eye"></i></a>
                </div>
              </div>
              <div class="mb-3 row">
                <label for="review_points" class="col-sm-2 col-form-label">Điểm</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="review_points" value="{{ i.review_points }}" disabled>
                </div>
              </div>
              <div class="mb-3 row">
                <label for="review_hard_skills" class="col-sm-2 col-form-label">Kiến thức</label>
                <div class="col-sm-10">
                  <textarea name="review_hard_skills" id="review_hard_skills" class="form-control" rows="5" disabled>{{ i.review_hard_skills }}</textarea>
                </div>
              </div>
              <div class="mb-3 row">
                <label for="review_soft_skills" class="col-sm-2 col-form-label">Kỹ năng</label>
                <div class="col-sm-10">
                  <textarea name="review_soft_skills" id="review_soft_skills" class="form-control" rows="5" disabled>{{ i.review_soft_skills }}</textarea>
                </div>
              </div>
              <div class="mb-3 row">
                <label for="review_notes" class="col-sm-2 col-form-label">Ghi chú</label>
                <div class="col-sm-10">
                  <textarea name="review_notes" id="review_notes" class="form-control" rows="5" disabled>{{ i.review_notes }}</textarea>
                </div>
              </div>
              <div class="mb-3 row">
                <div class="col-sm-2"></div>
                <button type="button" class="btn btn-primary col-sm-4" id="updateReview"><i class="fa-solid fa-pen-to-square"></i> Cập nhật đánh giá</button>
                <div class="col-sm-2"></div>
                <button type="button" class="btn btn-success col-sm-4" id="submitReview" disabled><i class="fa-solid fa-floppy-disk"></i> Lưu</button>
              </div>
            </form>
            {% endfor %}
          </div>
          <script>
            // Toast
            window.onload = function(){
              let token = localStorage.getItem('token');
              if(!token){
                $('#updateReview').prop('hidden', true);
                $('#submitReview').prop('hidden', true);
              }
            }
            // Toast
          let toastMixin = Swal.mixin({
                toast: true,
                icon: 'success',
                title: 'General Title',
                position: 'top-right',
                showConfirmButton: false,
                timer: 1500,
                didOpen: (toast) => {
                  toast.addEventListener('mouseenter', Swal.stopTimer)
                  toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
              });
            // Update review of student
            $('#updateReview').click(function(e){
              $("#review_points").prop('disabled', false);
              $("#review_hard_skills").prop('disabled', false);
              $("#review_soft_skills").prop('disabled', false);
              $("#review_notes").prop('disabled', false);
              $("#submitReview").prop('disabled', false);
              $("#updateReview").prop('disabled', true);
            });

            $('#submitReview').click(function(e){
              $("#review_points").prop('disabled', true);
              $("#review_hard_skills").prop('disabled', true);
              $("#review_soft_skills").prop('disabled', true);
              $("#review_notes").prop('disabled', true);
              $("#submitReview").prop('disabled', true);
              $("#updateReview").prop('disabled', false);

              let formData = {
                "student_id": $("#student_id").val(),
                "review_points": $("#review_points").val(),
                "review_hard_skills": $("#review_hard_skills").val(),
                "review_soft_skills": $("#review_soft_skills").val(),
                "review_notes": $("#review_notes").val()
              }

              $.ajax({
                url: 'update_review',
                type: 'POST',
                data: formData,
                headers: {
                        "accept": "application/json",
                        "Content-Type": "application/json",
                        "Authorization": "Bearer " + localStorage.getItem('token')
                    },
                success: function(response){
                      if(response.result==="OK"){
                        toastMixin.fire({
                            animation: true,
                            title: 'Cập nhật thông tin thành công'
                        });
                      }else{
                        toastMixin.fire({
                          animation: true,
                          icon: 'error',
                          title: 'Đã xảy ra lỗi'
                        });
                      }
                    },
                error: function(xhr, status, error){
                  toastMixin.fire({
                          animation: true,
                          icon: 'error',
                          title: 'Đã xảy ra lỗi'
                        });
                }
              });
            });
          </script>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
  </body>
</html>